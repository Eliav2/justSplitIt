rules_version = '2';

// service cloud.firestore {
//   match /databases/{database}/documents {
//     match /{document=**} {
//       allow read, write: if true; 
//     }
//   }
// }

service cloud.firestore {
    //    match /databases/{db}/documents {
    //        match /{doc=**} {
    //            allow read, write: if debug(request.auth) == null;
    //        }
    //    }
    match /databases/{database}/documents {
        // Allow read access to all documents
        //    match /{document=**} {
        //      allow read: if true;
        //      allow write: if request.auth != null;
        //    }





        // Allow write access to the 'event' collection only for authenticated users
        match /event/{eventId} {
            allow read: if true;
            //todo:improve
            allow write: if request.auth != null;
        }

        match /user/{userId} {
            allow read: if true;
            allow write: if request.auth.uid == userId;
        }


        // user can only read/write expenses of events he is a participant of
        match /expense/{expenseId} {
            allow read: if true;
            // allow create: if request.auth.uid in get(/events/$(resource.data.parentEventId)).data.participantsIds;
            allow create: if request.auth.uid in debug(get(/events/$(request.resource.data.parentEventId)).data.participantsIds);
            // allow create: if get(/events/$(request.resource.data.parentEventId));
//            allow read, update, delete: if debug(
//                    get(/events/$(request.resource.data.parentEventId)) == request.auth.uid
//            );


        }

    }
}